#CACHE{24*3600*31,statique}
[(#REM) a partir de saisies v6, la classe datePicker est ajoutée par défaut pour débrayer le traitement automatique du datepicker bootstrap du privé pour SPIP 4.x]
[(#ENV{class,datePicker}|setenv{class})]
[(#REM)
	Zone de saisie de date avec option heure.

	La valeur fournie peut être :
	- au format spip jj/mm/aaaa (date uniquement)
	- au format SQL aaaa-mm-jj (date uniquement)
	- au format SQL aaaa-mm-jj hh:mm:ss (date et heure)
	- un tableau avec une entrée "date" et une entrée "heure" séparée, au format SQL (date et heure obligatoire)

	Pour utiliser les heures, il faut utiliser l'option "horaire=oui".

	La valeur postée est au format 2025-12-31 ou 2025-12-31T12:30
]

[(#REM) Initialisation de la valeur ]
#SET{autodater,''}
[(#ENV{class}|=={'autodater'}|oui)
	#SET{autodater,#VAL{Y-m-d H:i:s}|date}
]
#SET{valeur,#ENV{valeur_forcee,#ENV{valeur,#ENV{defaut,#GET{autodater}}}}}

[(#REM) Regex de date SQL ]
#SET{date_sql,"[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]( [0-9][0-9]:[0-9][0-9]:[0-9][0-9])?"}

[(#REM) Si la valeur est un tableau, on considère que c'est date et heure dans un format déjà reconnu (j/m/a ou SQL) ]
[(#GET{valeur}|is_array|oui)
	#SET{date, #GET{valeur/date}|affdate{Y-m-d}}
	#SET{heure, #GET{valeur/heure}|affdate{H:i:s}}
]

[(#REM) Si la valeur est une chaîne, on regarde si SQL ]
[(#GET{valeur}|is_string|oui)
	[(#REM) Par défaut (date uniquement au format SPIP) la date c'est toute la valeur ]
	#SET{date, #GET{valeur}|affdate{Y-m-d}}
	#SET{heure, ''}

	[(#REM) Si c'est bien une date SQL ]
	[(#GET{valeur}|match{#GET{date_sql}}|oui)
		[(#REM) Si la date est complètement 0, on met des valeurs vides ]
		[(#GET{valeur}|=={0000-00-00 00:00:00}|oui)
			#SET{date, ''}
			#SET{heure, ''}
		]
		[(#GET{valeur}|=={0000-00-00 00:00:00}|non)
			#SET{date, #GET{valeur}|affdate{Y-m-d}}
			#SET{heure, #GET{valeur}|affdate{H:i}}
		]
	]
]

<p hidden id="format_date_#ENV{id}">[(#ENV{horaire}|?{<:saisies:format_date_heure_attendu:>,<:saisies:format_date_attendu:>})]</p>
#SET{describedby, #ENV{describedby}|concat{' ',format_date_#ENV{id}} }
[(#ENV{horaire}|oui)<div class="saisie_datetime">]
<INCLURE{fond=saisies/input,
	env,
	nom=#ENV{nom}|concat{#ENV{horaire}|?{\[date\]}},
	describedby=#GET{describedby},
	valeur=#GET{date},
	type=date
	}/>
[(#ENV{horaire}|oui)
	<INCLURE{fond=saisies/input,
		env,
		nom=#ENV{nom}|concat{\[heure\]},
		describedby=#GET{describedby},
		valeur=#GET{heure},
		type=time,
		size=4,
		maxlength=5
		}/>
</div>
]
